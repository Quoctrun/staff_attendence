-- Tạo bảng staff_attendance
CREATE TABLE staff_attendance (
    staff_id INT,
    date DATE,
    check_in INT
);

-- Chèn 100 dòng dữ liệu trực tiếp vào bảng
INSERT INTO staff_attendance (staff_id, date, check_in) VALUES
(1, '2024-01-01', 1),
(2, '2024-01-02', 1),
(3, '2024-01-03', 1),
(4, '2024-01-04', 1),
(5, '2024-01-05', 1),
(6, '2024-01-06', 2),
(7, '2024-01-07', 1),
(8, '2024-01-08', 1),
(9, '2024-01-09', 1),
(10, '2024-01-10', 1),
(1, '2024-01-11', 2),
(2, '2024-01-12', 1),
(3, '2024-01-13', 1),
(4, '2024-01-14', 2),
(5, '2024-01-15', 1),
(6, '2024-01-16', 1),
(7, '2024-01-17', 1),
(8, '2024-01-18', 1),
(9, '2024-01-19', 1),
(10, '2024-01-20', 1),
(1, '2024-01-21', 1),
(2, '2024-01-22', 1),
(3, '2024-01-23', 1),
(4, '2024-01-24', 1),
(5, '2024-01-25', 2),
(6, '2024-01-26', 1),
(7, '2024-01-27', 1),
(8, '2024-01-28', 1),
(9, '2024-01-29', 1),
(10, '2024-01-30', 1),
(1, '2024-01-31', 1),
(2, '2024-02-01', 1),
(3, '2024-02-02', 1),
(4, '2024-02-03', 2),
(5, '2024-02-04', 1),
(6, '2024-02-05', 1),
(7, '2024-02-06', 1),
(8, '2024-02-07', 1),
(9, '2024-02-08', 1),
(10, '2024-02-09', 2),
(1, '2024-02-10', 1),
(2, '2024-02-11', 1),
(3, '2024-02-12', 1),
(4, '2024-02-13', 1),
(5, '2024-02-14', 1),
(6, '2024-02-15', 1),
(7, '2024-02-16', 2),
(8, '2024-02-17', 1),
(9, '2024-02-18', 1),
(10, '2024-02-19', 1),
(1, '2024-02-20', 1),
(2, '2024-02-21', 2),
(3, '2024-02-22', 1),
(4, '2024-02-23', 1),
(5, '2024-02-24', 1),
(6, '2024-02-25', 1),
(7, '2024-02-26', 1),
(8, '2024-02-27', 1),
(9, '2024-02-28', 1),
(10, '2024-02-29', 1),
(1, '2024-03-01', 1),
(2, '2024-03-02', 1),
(3, '2024-03-03', 1),
(4, '2024-03-04', 1),
(5, '2024-03-05', 2),
(6, '2024-03-06', 1),
(7, '2024-03-07', 1),
(8, '2024-03-08', 1),
(9, '2024-03-09', 1),
(10, '2024-03-10', 1),
(1, '2024-03-11', 1),
(2, '2024-03-12', 1),
(3, '2024-03-13', 1),
(4, '2024-03-14', 2),
(5, '2024-03-15', 1),
(6, '2024-03-16', 1),
(7, '2024-03-17', 1),
(8, '2024-03-18', 1),
(9, '2024-03-19', 1),
(10, '2024-03-20', 2),
(1, '2024-03-21', 1),
(2, '2024-03-22', 1),
(3, '2024-03-23', 1),
(4, '2024-03-24', 1),
(5, '2024-03-25', 1),
(6, '2024-03-26', 1),
(7, '2024-03-27', 2),
(8, '2024-03-28', 1),
(9, '2024-03-29', 1),
(10, '2024-03-30', 1);

-- Xem dữ liệu vừa tạo
SELECT * FROM staff_attendance;

WITH cte AS (
    SELECT 
        staff_id, 
        date,
        check_in,
        ROW_NUMBER() OVER (PARTITION BY staff_id ORDER BY date) - 
        ROW_NUMBER() OVER (PARTITION BY staff_id, check_in ORDER BY date) AS grp
    FROM 
        staff_attendance
    WHERE 
        check_in = 1
),
streaks AS (
    SELECT 
        staff_id, 
        MIN(date) AS start_date, 
        MAX(date) AS end_date, 
        COUNT(*) AS streak_length
    FROM 
        cte
    GROUP BY 
        staff_id, grp
)
SELECT 
    staff_id, 
    MAX(streak_length) AS longest_streak
FROM 
    streaks
GROUP BY 
    staff_id
ORDER BY 
    longest_streak DESC
LIMIT 1;
